CREATE TABLE DISMAX
(
ID INT,
RID INT,
VAL INT
);

INSERT INTO DISMAX VALUES (121,9,1);
INSERT INTO DISMAX VALUES (121,9,8);
INSERT INTO DISMAX VALUES (122,9,14);
INSERT INTO DISMAX VALUES (122,9,0);
INSERT INTO DISMAX VALUES (122,9,1);
INSERT INTO DISMAX VALUES (123,9,1);
INSERT INTO DISMAX VALUES (123,9,2);
INSERT INTO DISMAX VALUES (123,9,10);


WITH CTE AS
(
SELECT ID,RID,VAL,ROW_NUMBER() OVER (PARTITION BY ID,RID ORDER BY VAL DESC) RNK
FROM DISMAX
)
SELECT COUNT(DISTINCT ID) AS DIS_ID,
RID,
SUM(VAL) AS TOT
FROM CTE WHERE RNK=1 GROUP BY RID;