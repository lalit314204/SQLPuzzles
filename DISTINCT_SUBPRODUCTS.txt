CREATE TABLE DISPROD
(
ID INT,
PROD CHAR(1),
SUBPROD CHAR(5)
);

INSERT INTO DISPROD VALUES (1,'A','SUB1');
INSERT INTO DISPROD VALUES (2,'A','SUB1');
INSERT INTO DISPROD VALUES (3,'A','SUB2');
INSERT INTO DISPROD VALUES (4,'B','SUB3');
INSERT INTO DISPROD VALUES (5,'C','SUB4');
INSERT INTO DISPROD VALUES (6,'C','SUB4');
INSERT INTO DISPROD VALUES (7,'C','SUB4');
INSERT INTO DISPROD VALUES (8,'C','SUB5');
INSERT INTO DISPROD VALUES (9,'A','SUB6');


SELECT ID,PROD,SUBPROD,DENSE_RANK() OVER (PARTITION BY PROD ORDER BY SUBPROD DESC) +
DENSE_RANK() OVER (PARTITION BY PROD ORDER BY SUBPROD) -1 FROM DISPROD;